generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  DRIVER
  CUSTOMER
  CORPORATE
}

enum MembershipStatus {
  STANDARD
  VIP
  CORPORATE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BookingType {
  INDIVIDUAL
  AIRPORT_VIP
  VIP_TRANSFER
  WEDDING
  CORPORATE_EVENT
}

enum TripType {
  SINGLE_TRIP
  MULTI_STOP
  HOURLY_RENTAL
  TOUR_PACKAGE
}

enum PaymentType {
  INSTANT_BILLING
  CORPORATE_BILLING
}

model User {
  id                String            @id @default(uuid())
  email             String            @unique
  password          String
  firstName         String
  lastName          String
  phone             String
  role              UserRole          @default(CUSTOMER)
  membershipStatus  MembershipStatus  @default(STANDARD)
  profileImage      String?
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  bookings          Booking[]
  driverProfile     Driver?
  corporateAccount  CorporateAccount?
  savedAddresses    SavedAddress[]
  savedCards        SavedCard[]
  preferences       UserPreference?
  reviews           Review[]
}

model Driver {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  licenseNumber   String    @unique
  licenseExpiry   DateTime
  experience      Int
  rating          Float     @default(0)
  totalTrips      Int       @default(0)
  isAvailable     Boolean   @default(true)
  currentLocation String?
  
  assignedVehicle Vehicle?
  trips           Booking[]
  reviews         Review[]
}

model Vehicle {
  id              String    @id @default(uuid())
  name            String
  type            String
  brand           String
  model           String
  year            Int
  capacity        Int
  luggageCapacity Int
  pricePerHour    Float
  images          String    @db.Text
  features        String    @db.Text
  isADACompliant  Boolean   @default(false)
  isAvailable     Boolean   @default(true)
  licensePlate    String    @unique
  
  driverId        String?   @unique
  driver          Driver?   @relation(fields: [driverId], references: [id])
  bookings        Booking[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Booking {
  id              String        @id @default(uuid())
  bookingNumber   String        @unique
  customerId      String
  customer        User          @relation(fields: [customerId], references: [id])
  driverId        String?
  driver          Driver?       @relation(fields: [driverId], references: [id])
  vehicleId       String
  vehicle         Vehicle       @relation(fields: [vehicleId], references: [id])
  
  bookingType     BookingType
  tripType        TripType
  
  pickupLocation  String        @db.Text
  dropLocation    String        @db.Text
  pickupDate      DateTime
  pickupTime      String
  
  flightNumber    String?
  pickupSign      String?
  specialNotes    String?       @db.Text
  referenceCode   String?
  
  status          BookingStatus @default(PENDING)
  paymentType     PaymentType   @default(INSTANT_BILLING)
  
  basePrice       Float
  addonPrice      Float         @default(0)
  totalPrice      Float
  tipAmount       Float         @default(0)
  
  isPaid          Boolean       @default(false)
  
  bookingAddons   BookingAddon[]
  extraStops      ExtraStop[]
  payment         Payment?
  review          Review?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Addon {
  id              String    @id @default(uuid())
  name            String
  type            String
  description     String?   @db.Text
  price           Float
  isActive        Boolean   @default(true)
  icon            String?
  
  bookingAddons   BookingAddon[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model BookingAddon {
  id              String    @id @default(uuid())
  bookingId       String
  booking         Booking   @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  addonId         String
  addon           Addon     @relation(fields: [addonId], references: [id])
  quantity        Int       @default(1)
  price           Float
  
  @@index([bookingId])
  @@index([addonId])
}

model ExtraStop {
  id              String    @id @default(uuid())
  bookingId       String
  booking         Booking   @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  location        String    @db.Text
  stopOrder       Int
  notes           String?   @db.Text
  
  @@index([bookingId])
}

model Payment {
  id              String    @id @default(uuid())
  bookingId       String    @unique
  booking         Booking   @relation(fields: [bookingId], references: [id])
  amount          Float
  tipAmount       Float     @default(0)
  paymentMethod   String
  transactionId   String?
  status          String    @default("pending")
  paidAt          DateTime?
  createdAt       DateTime  @default(now())
}

model Review {
  id              String    @id @default(uuid())
  bookingId       String    @unique
  booking         Booking   @relation(fields: [bookingId], references: [id])
  customerId      String
  customer        User      @relation(fields: [customerId], references: [id])
  driverId        String
  driver          Driver    @relation(fields: [driverId], references: [id])
  rating          Int
  comment         String?   @db.Text
  createdAt       DateTime  @default(now())
}

model CorporateAccount {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  companyName     String
  billingAddress  String    @db.Text
  taxId           String?
  creditLimit     Float?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model SavedAddress {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  label           String
  address         String    @db.Text
  isDefault       Boolean   @default(false)
  createdAt       DateTime  @default(now())
  
  @@index([userId])
}

model SavedCard {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  cardLastFour    String
  cardBrand       String
  expiryMonth     Int
  expiryYear      Int
  isDefault       Boolean   @default(false)
  createdAt       DateTime  @default(now())
  
  @@index([userId])
}

model UserPreference {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  preferredMusic  String?
  preferredTemp   String?
  beveragePrefs   String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model CityPackage {
  id              String    @id @default(uuid())
  fromCity        String
  toCity          String
  distance        Float
  duration        String
  basePrice       Float
  description     String?   @db.Text
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model TourPackage {
  id              String    @id @default(uuid())
  title           String
  description     String    @db.Text
  destinations    String    @db.Text
  duration        String
  price           Float
  images          String    @db.Text
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}